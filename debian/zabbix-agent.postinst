#!/bin/sh

CONFFILE1="/etc/zabbix/zabbix_agentd.conf"
CONFFILE2="/etc/zabbix/zabbix_agent.conf"

. /usr/share/debconf/confmodule
db_version 2.0 || [ $? -lt 30 ]

if [ "$1" = "configure" ] && [ `md5sum $CONFFILE1 | awk '{print $1}'` = "78ed313a55b9138b7a94085762e6bfa5" ]; then

    RET=""
	db_get zabbix-agent/server || true
	zabbix_server="$RET"
    sed -i "s/\@zabbixserver\@/$zabbix_server/g" $CONFFILE1 2> /dev/null
    sed -i "s/\@zabbixserver\@/$zabbix_server/g" $CONFFILE2 2> /dev/null

    if ! getent group zabbix > /dev/null 2>&1 ; then
    addgroup --system --quiet zabbix
    fi

    if ! getent passwd zabbix > /dev/null 2>&1 ; then
    adduser --quiet \
        --system --disabled-login --ingroup zabbix \
        --home /var/run/zabbix-server/ --no-create-home \
        zabbix
    fi
    chown zabbix:zabbix /var/log/zabbix-agent -R
    chown zabbix:zabbix /var/run/zabbix-agent -R
fi

#DEBHELPER#

exit 0
